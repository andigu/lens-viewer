(this["webpackJsonplens-viewer"]=this["webpackJsonplens-viewer"]||[]).push([[0],{110:function(e,a,t){e.exports=t(141)},115:function(e,a,t){},141:function(e,a,t){"use strict";t.r(a);var n=t(0),r=t.n(n),c=t(10),l=t.n(c),i=(t(115),t(199)),o=t(200),s=t(44),d=t(13),u=t(63),m=t(3),p=t(181),f=t(17),E=t(193),g=t(194),h=t(189),b=t(41),v=t(180),y=t(205),x=t(195),w=t(178),C=t(191),k=t(196),O=t(197),j=t(198),S=t(90),I=t.n(S),L=t(91),N=t.n(L),B=t(92),_=t.n(B),D=t(93),F=t.n(D),P=t(192),R=t(50),U=t.n(R),M=U.a.create({baseURL:"",withCredentials:!0}),G=t(171),W=t(174),z=t(175),A=t(176),H=t(201),T=t(179);function J(e){var a=e.open,t=e.onLogin,n=r.a.useState(""),c=Object(d.a)(n,2),l=c[0],i=c[1],o=r.a.useState(""),s=Object(d.a)(o,2),u=s[0],m=s[1],p=function(){0===l.trim().length?m("Enter a valid user ID"):M.post("/login",{user_id:l}).then((function(e){e.data.success?(t(l),i(""),m("")):m("Something unexpected went wrong")}))};return r.a.createElement("div",null,r.a.createElement(G.a,{open:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(W.a,{id:"form-dialog-title"},"Log in"),r.a.createElement(z.a,null,r.a.createElement(A.a,null,"Log in with a user id to save your batches"),r.a.createElement(H.a,{autoFocus:!0,margin:"dense",id:"user_id",label:"User ID",type:"text",fullWidth:!0,value:l,onChange:function(e){return i(e.target.value)},error:Boolean(u),onKeyDown:function(e){13===e.keyCode&&p()},helperText:u})),r.a.createElement(T.a,null,r.a.createElement(v.a,{onClick:p,color:"primary"},"Login"))))}var K=t(94),V=t(182),X=Object(p.a)((function(e){return{fileUpload:{backgroundColor:"#f1f1f1",padding:e.spacing(3)},buttonProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12},wrapper:{position:"relative"}}}));function Y(e){var a=X(),t=e.uploadOpen,n=e.handleClose,c=r.a.useState(!1),l=Object(d.a)(c,2),i=l[0],o=l[1];return r.a.createElement(G.a,{open:t,onClose:n},r.a.createElement(K.a,{accept:".csv"},(function(e){var t=e.getRootProps,c=e.getInputProps,l=e.acceptedFiles;return r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,null,"Upload batches"),r.a.createElement(z.a,null,r.a.createElement("div",null,r.a.createElement("div",t({className:a.fileUpload}),r.a.createElement("input",c()),l.length>0?l.map((function(e){return r.a.createElement("li",{key:e.path},e.path," - ",(e.size/1e6).toFixed(2)," Mb")})):r.a.createElement(b.a,{variant:"body2"},"Click to upload your .csvs")))),r.a.createElement(T.a,null,r.a.createElement(v.a,{color:"primary",onClick:n},"Cancel"),r.a.createElement("div",{className:a.wrapper},r.a.createElement(v.a,{color:"primary",disabled:i,onClick:function(){var e=new FormData;l.forEach((function(a){return e.append(a.name,a)})),o(!0),U.a.post("/upload-batches",e,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}).then((function(e){o(!1),n()})).catch((function(){o(!1)}))}},"Upload"),i&&r.a.createElement(V.a,{size:24,className:a.buttonProgress}))))})))}var $=t(47),q=t(96),Q=t(204),Z=t(89),ee=t.n(Z),ae=t(183),te=t(184),ne=t(185),re=t(186),ce=t(187),le=t(188),ie=t(86),oe=t.n(ie),se=t(85),de=t.n(se);function ue(e){var a=e.candidate,t=r.a.useState(!1),n=Object(d.a)(t,2),c=n[0],l=n[1];return r.a.createElement(ae.a,{component:q.a},r.a.createElement(te.a,{size:"small"},r.a.createElement(ne.a,null,r.a.createElement(re.a,null,r.a.createElement(ce.a,null,r.a.createElement("b",null,"Parameter")),r.a.createElement(ce.a,null,r.a.createElement("b",null,"Value")))),r.a.createElement(le.a,null,r.a.createElement(re.a,null,r.a.createElement(ce.a,{component:"th",scope:"row"},"RA"),r.a.createElement(ce.a,null,a.ra.toFixed(5))),r.a.createElement(re.a,null,r.a.createElement(ce.a,{component:"th",scope:"row"},"DEC"),r.a.createElement(ce.a,null,a.dec.toFixed(5))),r.a.createElement(re.a,null,r.a.createElement(ce.a,{component:"th",scope:"row"},"Grade"),r.a.createElement(ce.a,null,a.grade)),r.a.createElement(re.a,null,r.a.createElement(ce.a,{component:"th",scope:"row"},"URL"),r.a.createElement(ce.a,null,r.a.createElement("a",{href:a.url,target:"_blank",rel:"noopener noreferrer"},"Skyviewer"))),r.a.createElement(re.a,null,r.a.createElement(ce.a,{component:"th",scope:"row"},"Additional"),r.a.createElement(ce.a,null,r.a.createElement(h.a,{"aria-label":"expand row",size:"small",onClick:function(){return l(!c)}},c?r.a.createElement(de.a,null):r.a.createElement(oe.a,null)))),c&&Object.entries(JSON.parse(a.additional)).map((function(e,a){var t=Object(d.a)(e,2),n=t[0],c=t[1];return r.a.createElement(re.a,{key:a},r.a.createElement(ce.a,{component:"th",scope:"row"},n),r.a.createElement(ce.a,null,c))})))))}var me=t(202),pe=t(190),fe=t(14),Ee=t.n(fe),ge=Object(p.a)((function(e){return{paper:{padding:e.spacing(3),gap:"".concat(e.spacing(1),"px"),display:"flex",flexDirection:"column",justifyContent:"space-evenly",flex:1},container:{flex:1,display:"flex",flexDirection:"column"}}}));function he(e){var a=ge(),t=e.batch,n=e.counts;return r.a.createElement("div",{className:a.container},r.a.createElement(q.a,{className:a.paper},r.a.createElement(b.a,{variant:"h6"},"Batch ",t.name," metrics"),r.a.createElement(me.a,{display:"flex",alignItems:"center"},r.a.createElement(me.a,{minWidth:"125px"},r.a.createElement(b.a,{variant:"body2",color:"textSecondary"},"Grading progress: ")),r.a.createElement(me.a,{width:"100%",mr:1},r.a.createElement(pe.a,{variant:"determinate",value:Ee.a.sum(n)/t.n_cands*100})),r.a.createElement(me.a,null,r.a.createElement(b.a,{variant:"body2",color:"textSecondary"},Ee.a.sum(n),"/",t.n_cands))),r.a.createElement(b.a,{variant:"body2",color:"textSecondary"},"Marked A's: ",n[0]," (",(n[0]/t.n_cands*100).toFixed(2),"%)"),r.a.createElement(b.a,{variant:"body2",color:"textSecondary"},"Marked B's: ",n[1]," (",(n[1]/t.n_cands*100).toFixed(2),"%)"),r.a.createElement(b.a,{variant:"body2",color:"textSecondary"},"Marked C's: ",n[2]," (",(n[2]/t.n_cands*100).toFixed(2),"%)"),r.a.createElement(b.a,{variant:"body2",color:"textSecondary"},"Marked D's: ",n[3]," (",(n[3]/t.n_cands*100).toFixed(2),"%)"),r.a.createElement(b.a,{variant:"body2",color:"textSecondary"},"Marked non-lens: ",n[4]," (",(n[4]/t.n_cands*100).toFixed(2),"%)"),r.a.createElement(v.a,{variant:"outlined",onClick:function(){M.get("/export_batch",{params:{batch_id:t.id},withCredentials:!0,responseType:"blob"}).then((function(e){var a=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=a,n.setAttribute("download","".concat(t.name,".csv")),document.body.appendChild(n),n.click()}))}},"Export to CSV")))}var be=t(87),ve=t(88),ye=t(95),xe=["Grade A","Grade B","Grade C","Grade D","Non lens"],we=Object(p.a)((function(e){return{card:{display:"flex",flexDirection:"row",padding:"".concat(e.spacing(1),"px"),alignItems:"center",justifyContent:"space-between"}}}));function Ce(e){var a=e.candidates,t=e.batch,n=e.loadCands,c=e.cursor,l=e.setCursor,i=we(),o=r.a.createRef(),s=function(e){return Boolean(a[e])};return r.a.useEffect((function(){o.current&&c>=0&&o.current.scrollToItem(c,"center")}),[c]),r.a.createElement(q.a,{style:{height:"100%"}},r.a.createElement(be.a,null,(function(e){var d=e.height,u=e.width;return r.a.createElement(ve.a,{isItemLoaded:s,itemCount:t.n_cands,minimumBatchSize:20,loadMoreItems:n},(function(e){var n=e.onItemsRendered,m=e.ref;return r.a.createElement(ye.a,{height:d,width:u,itemSize:100,itemCount:t.n_cands,ref:function(e){e&&(m(e),o.current=e)},onItemsRendered:n,layout:"vertical"},(function(e){var t=e.index,n=e.style;return r.a.createElement(C.a,{key:t,style:n,className:i.card,button:!0,selected:t===c,onClick:function(){return l(t)}},r.a.createElement("div",null,s(t)?r.a.createElement(r.a.Fragment,null,r.a.createElement(b.a,{variant:"body1"},"Cand #",a[t].order),r.a.createElement(b.a,{variant:"body1",style:{color:a[t].grade?"green":"red"}},a[t].grade?xe[a[t].grade-1]:"Ungraded")):r.a.createElement(b.a,{variant:"body1"},"Loading...")),s(t)&&r.a.createElement("img",{src:a[t].url,style:{height:"100%"},alt:"Lens preview"}))}))}))})))}var ke=t(203),Oe=Object(p.a)((function(e){return{content:{display:"flex",flexDirection:"row",backgroundColor:e.palette.background.default,height:"calc(100vh - ".concat(e.mixins.toolbar.minHeight,"px - 3*").concat(e.spacing(3),"px)"),gap:"".concat(e.spacing(2),"px")},leftContainer:{display:"flex",flex:4,gap:"".concat(e.spacing(2),"px"),flexDirection:"column"},rightContainer:{display:"flex",flex:8,gap:"".concat(e.spacing(2),"px"),flexDirection:"column"},lensDataContainer:{flex:8},metricContainer:{display:"flex",flex:4},imgListContainer:{flex:11,display:"flex",gap:"".concat(e.spacing(1),"px")},paper:{height:"100%",maxWidth:"100%",padding:e.spacing(3),gap:"".concat(e.spacing(1),"px")},img:{height:"100%",maxWidth:"100%",display:"block",marginLeft:"auto",marginRight:"auto"},button:{margin:e.spacing(1)}}}));function je(e){var a=Oe(),t=e.batch,n=r.a.useState(""),c=Object(d.a)(n,2),l=c[0],i=c[1],o=r.a.useState(new Array(t.n_cands)),s=Object(d.a)(o,2),u=s[0],m=s[1],p=r.a.useState(-1),f=Object(d.a)(p,2),E=f[0],g=f[1],h=r.a.useState([0,0,0,0,0]),y=Object(d.a)(h,2),x=y[0],w=y[1],C=r.a.useState(!1),k=Object(d.a)(C,2),O=k[0],j=k[1],S=function(e,a){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(E>=0||n)&&M.get("/candidates",{params:{start:e,stop:a,batch_id:t.id}}).then((function(e){var a=Ee.a.sortBy(e.data.candidates,"order"),t=e.data.candidates.map((function(e){return e.order}));m((function(e){return Ee.a.concat(Ee.a.slice(e,0,Ee.a.min(t)),a,Ee.a.slice(e,Ee.a.max(t)+1))}))}))};r.a.useEffect((function(){M.get("/cursor",{params:{batch_id:t.id}}).then((function(e){g(e.data.cursor),S(e.data.cursor-10,e.data.cursor+10,!0)})),M.get("/batch_stats",{params:{batch_id:t.id}}).then((function(e){return w(e.data.counts)}))}),[t.id]);var I=u[E];return r.a.useEffect((function(){I&&i(I.comment)}),[I]),r.a.createElement("div",{className:a.content,onKeyPress:function(e){if(["1","2","3","4","5"].includes(e.key)){var a=parseInt(e.key),n=I.order;M.post("/candidates",{id:I.id,grade:a}).then((function(e){w(e.data.counts),g((function(e){return Math.min(e+1,t.n_cands-1)})),m((function(e){return[].concat(Object($.a)(Ee.a.slice(e,0,n)),[Ee.a.update(e[n],"grade",(function(){return a}))],Object($.a)(Ee.a.slice(e,n+1)))}))}))}else"b"===e.key?g((function(e){return Math.max(0,e-1)})):"n"===e.key&&g((function(e){return Math.min(e+1,t.n_cands-1)}))},tabIndex:"0"},r.a.createElement("div",{className:a.leftContainer},r.a.createElement("div",{className:a.lensDataContainer,style:{overflowY:"scroll"}},r.a.createElement(q.a,{className:a.paper,style:{overflowX:"scroll"}},r.a.createElement(b.a,{variant:"h6"},"Lens Data"),I?r.a.createElement(ue,{candidate:I}):r.a.createElement(b.a,null,"Loading..."))),r.a.createElement("div",{className:a.metricContainer},r.a.createElement(he,{batch:t,counts:x}))),r.a.createElement("div",{className:a.rightContainer},r.a.createElement("div",{className:a.imgListContainer},r.a.createElement("div",{style:{flex:9}},r.a.createElement(q.a,{className:a.paper},I?r.a.createElement("img",{className:a.img,alt:"Lens candidate",src:I.url}):r.a.createElement(b.a,null,"Loading..."))),r.a.createElement("div",{style:{flex:3}},r.a.createElement(Ce,{candidates:u,batch:t,loadCands:S,cursor:E,setCursor:g}))),r.a.createElement("div",null,r.a.createElement(q.a,{className:a.paper,style:{display:"flex"}},r.a.createElement(H.a,{label:"Comments",multiline:!0,fullWidth:!0,value:l,onKeyPressCapture:function(e){return e.stopPropagation()},onChange:function(e){i(e.target.value),e.stopPropagation()}}),r.a.createElement(v.a,{variant:"contained",color:"primary",className:a.button,onClick:function(){var e=I.order;M.post("/candidates",{id:I.id,comment:l}).then((function(a){j(!0),m((function(a){return[].concat(Object($.a)(Ee.a.slice(a,0,e)),[Ee.a.update(a[e],"comment",(function(){return l}))],Object($.a)(Ee.a.slice(a,e+1)))}))}))},endIcon:r.a.createElement(ee.a,null)},"Comment"),r.a.createElement(Q.a,{open:O,autoHideDuration:2e3,onClose:function(){return j(!1)}},r.a.createElement(ke.a,{elevation:6,variant:"filled",onClose:function(){return j(!1)},severity:"success"},"Comment submitted!"))))))}var Se=Object(p.a)((function(e){return{root:{display:"flex",width:"100%"},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:"calc(100% - ".concat(240,"px)"),marginLeft:240,transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},menuButton:{marginRight:e.spacing(2)},hide:{display:"none"},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},drawerHeader:Object(u.a)(Object(u.a)({display:"flex",alignItems:"center",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-end"}),content:{flexGrow:1,padding:e.spacing(3),transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:-240},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginLeft:0}}}));function Ie(e){var a=Se(),t=Object(f.a)(),n=r.a.useState(!0),c=Object(d.a)(n,2),l=c[0],i=c[1],o=(e.children,Object(P.a)(["userId","selectedBatchId"])),u=Object(d.a)(o,3),p=u[0],S=u[1],L=u[2],B=r.a.useState([]),D=Object(d.a)(B,2),R=D[0],U=D[1],G=r.a.useState(!1),W=Object(d.a)(G,2),z=W[0],A=W[1],H=function(){p.userId&&M.get("/batches").then((function(e){U(e.data.batches)}))};r.a.useEffect(H,[p.userId]);var T=Ee.a.keyBy(R,"id")[parseInt(p.selectedBatchId)];return r.a.createElement("div",{className:a.root},r.a.createElement(J,{open:!Boolean(p.userId),onLogin:function(e){S("userId",e)}}),r.a.createElement(Y,{uploadOpen:z,handleClose:function(){A(!1),H()}}),r.a.createElement(E.a,{position:"fixed",className:Object(m.a)(a.appBar,Object(s.a)({},a.appBarShift,l))},r.a.createElement(g.a,null,r.a.createElement(h.a,{color:"inherit","aria-label":"open drawer",onClick:function(){return i(!0)},edge:"start",className:Object(m.a)(a.menuButton,l&&a.hide)},r.a.createElement(I.a,null)),r.a.createElement(b.a,{variant:"h6",style:{flexGrow:1}},"Logged in user: ",p.userId),p.userId&&r.a.createElement(v.a,{color:"inherit",variant:"outlined",onClick:function(){L("userId"),L("selectedBatchId"),U([])}},"Logout"))),r.a.createElement(y.a,{className:a.drawer,variant:"persistent",anchor:"left",open:l,classes:{paper:a.drawerPaper}},r.a.createElement("div",{className:a.drawerHeader},r.a.createElement(h.a,{onClick:function(){return i(!1)}},"ltr"===t.direction?r.a.createElement(N.a,null):r.a.createElement(_.a,null))),r.a.createElement(x.a,null),r.a.createElement(w.a,null,r.a.createElement(C.a,{button:!0,onClick:function(){return A(!0)}},r.a.createElement(k.a,null,r.a.createElement(F.a,null)),r.a.createElement(O.a,{primary:"Upload"}))),r.a.createElement(x.a,null),r.a.createElement(w.a,{subheader:r.a.createElement(j.a,null,"Batches")},R.map((function(e){return r.a.createElement(C.a,{button:!0,key:e.id,onClick:function(){return S("selectedBatchId",e.id)},selected:parseInt(p.selectedBatchId)===e.id},r.a.createElement(O.a,{primary:e.name,secondary:r.a.createElement(r.a.Fragment,null,"Count: ",e.n_cands," ",r.a.createElement("br",null),"Created: ",new Date(Date.parse(e.upload_time)).toLocaleString("en-GB"))}))})))),r.a.createElement("main",{className:Object(m.a)(a.content,Object(s.a)({},a.contentShift,l))},r.a.createElement("div",{className:a.drawerHeader}),T&&p.userId?r.a.createElement(je,{batch:T}):r.a.createElement(b.a,null,"Select a batch to grade")))}function Le(){return r.a.createElement(i.a,null,r.a.createElement(o.a,null),r.a.createElement(Ie,null))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(Le,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[110,1,2]]]);
//# sourceMappingURL=main.91cb7db6.chunk.js.map